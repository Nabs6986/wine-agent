{% extends "base.html" %}

{% block title %}Inbox - Wine Agent{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Inbox</h1>
    {% if wine_limit and wine_count >= wine_limit %}
    <span class="btn btn-primary btn-disabled" title="Wine limit reached">New Note</span>
    {% else %}
    <a href="/inbox/new" class="btn btn-primary">New Note</a>
    {% endif %}
</div>

{% if wine_limit %}
<div class="wine-usage">
    <span class="wine-usage-text"><strong>{{ wine_count }}</strong> / {{ wine_limit }} wines</span>
    <div class="wine-usage-bar">
        {% set usage_percent = (wine_count / wine_limit * 100)|int %}
        <div class="wine-usage-fill {% if usage_percent >= 100 %}full{% elif usage_percent >= 80 %}warning{% endif %}"
             style="width: {{ [usage_percent, 100]|min }}%"></div>
    </div>
    {% if wine_count >= wine_limit %}
    <span class="upgrade-prompt">
        Upgrade to <span class="tier-badge tier-pro">PRO</span> for unlimited wines
    </span>
    {% endif %}
</div>
{% endif %}

<div class="filters">
    <a href="/inbox?filter=open" class="filter-btn {% if current_filter == 'open' %}active{% endif %}">Open</a>
    <a href="/inbox?filter=converted" class="filter-btn {% if current_filter == 'converted' %}active{% endif %}">Converted</a>
    <a href="/inbox?filter=all" class="filter-btn {% if current_filter == 'all' %}active{% endif %}">All</a>
</div>

{% if items %}
<div class="inbox-list">
    {% for item in items %}
    <div class="inbox-item {% if item.converted %}converted{% endif %}">
        <a href="/inbox/{{ item.id }}">
            <div class="item-preview">
                {{ item.raw_text[:150] }}{% if item.raw_text|length > 150 %}...{% endif %}
            </div>
            <div class="item-meta">
                <span class="date">{{ item.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
                {% if item.tags %}
                <span class="tags">
                    {% for tag in item.tags %}
                    <span class="tag">{{ tag }}</span>
                    {% endfor %}
                </span>
                {% endif %}
                {% if item.converted %}
                <span class="status converted">Converted</span>
                {% else %}
                <span class="status open">Open</span>
                {% endif %}
            </div>
        </a>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="empty-state">
    <p>No inbox items found.</p>
    <a href="/inbox/new" class="btn btn-primary">Create your first note</a>
</div>
{% endif %}
{% endblock %}
