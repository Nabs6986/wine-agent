{% extends "base.html" %}

{% block title %}New Inbox Item - Wine Agent{% endblock %}

{% block content %}
<div class="page-header">
    <h1>New Tasting Note</h1>
</div>

{% if wine_limit %}
<div class="wine-usage">
    <span class="wine-usage-text"><strong>{{ wine_count }}</strong> / {{ wine_limit }} wines</span>
    <div class="wine-usage-bar">
        {% set usage_percent = (wine_count / wine_limit * 100)|int %}
        <div class="wine-usage-fill {% if usage_percent >= 100 %}full{% elif usage_percent >= 80 %}warning{% endif %}"
             style="width: {{ [usage_percent, 100]|min }}%"></div>
    </div>
</div>
{% endif %}

{% if error %}
<div class="alert alert-error">
    <strong>Cannot save:</strong> {{ error }}
    {% if show_upgrade %}
    <div class="upgrade-prompt" style="margin-top: var(--space-sm);">
        Upgrade to <span class="tier-badge tier-pro">PRO</span> for unlimited wines
    </div>
    {% endif %}
</div>
{% endif %}

{% if limit_reached %}
<div class="feature-locked">
    <div class="feature-locked-header">
        <span class="feature-locked-icon">ðŸ”’</span>
        <span class="feature-locked-title">Wine Limit Reached</span>
    </div>
    <p class="feature-locked-message">
        You've reached the maximum of <strong>{{ wine_limit }} wines</strong> on the FREE tier.
    </p>
    <p class="settings-note">
        Upgrade to <strong>PRO</strong> for unlimited wines, AI-powered conversion, and data exports.
    </p>
    <a href="/inbox" class="btn btn-secondary">Back to Inbox</a>
</div>
{% else %}
<form method="POST" action="/inbox" class="form">
    <div class="form-group">
        <label for="raw_text">Tasting Notes</label>
        <textarea
            name="raw_text"
            id="raw_text"
            rows="12"
            placeholder="Paste your tasting notes here...

Example:
2019 Domaine de la RomanÃ©e-Conti, RomanÃ©e-Conti Grand Cru
Deep ruby with garnet edge. Intense nose of rose petals, red cherry, and exotic spices.
On the palate, silky tannins with remarkable precision..."
            required
        >{{ raw_text if raw_text else '' }}</textarea>
        <small>Enter your free-form tasting notes. They will be converted to a structured format using AI.</small>
    </div>

    <div class="form-group">
        <label for="tags">Tags (optional)</label>
        <input
            type="text"
            name="tags"
            id="tags"
            value="{{ tags if tags else '' }}"
            placeholder="burgundy, pinot noir, special occasion"
        >
        <small>Comma-separated tags for organization</small>
    </div>

    <div class="form-actions">
        <a href="/inbox" class="btn btn-secondary">Cancel</a>
        <button type="submit" class="btn btn-primary">Save to Inbox</button>
    </div>
</form>
{% endif %}
{% endblock %}
